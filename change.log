Мультишаблон для чата

20190527 Версия 4.0.2.46
Незначительные доработки и оптимизации.
Оформление исходного кода в соответствии со стилем Чарльза Калверта.

20180925 Версия 4.0.1.45
Фикс: Исправлено сохранение и восстановление имени последнего открытого файла.

20180615 Версия 4.0.0.44
Восстановлена оригинальная иконка программы для лучшего соответствия критериям свободного ПО.
Реализована концепция нескольких файлов списков команд:
— файлы создаются, сохраняются и загружаются динамически из самой программы;
— каждый файл может иметь заголовочную строку с целевым окном и горячими клавишами;
— восстановлена поддержка до двух горячих клавиш у каждой команды;
— файлы по умолчанию хранятся в папке с программой.
Записи THotKey и TCommand переделаны в классы, что позволило реализовать список команд как TObjectList.
Жёстко прописанные значения вынесены как константы.
Главное окно:
— добавлена строка меню с файловыми операциями, диалоговыми окнами и справкой;
— перекрытый WndProc в целях надежности заменён обработчиками сообщений Windows;
— устаревший способ эмуляции событий копировать-вставить заменён на SendInput;
— флаг свёрнутости IsHidden объединен со свойством прозрачности AlphaBlend;
— согласованы размеры шрифта команд и горячих клавиш и убрана зависимость между ними.
Редактор списка команд:
— добавлена панель редактирования заголовка списка с автоматическим заполнением заголовка целевого окна;
— горячие клавиши при вводе на лету проверяются на правильность;
— теперь пустая команда автоматически распознаётся как разделитель.
Объединены вкладки в окне настроек программы.
Подпапки проекта \bin и \src объединены в \source.
Модуль CommandList переименован на CmdList, а Commands – на Editor. Также убран префикс «u» перед именами модулей.
Прочие мелкие улучшения.

20161211 Версия 3.2.2.43
Устаревший TextFile заменён на TStringList.

20150626 Версия 3.2.1.42
Исправлена критическая ошибка при запуске программы.

20150625 Версия 3.2.0.41
Возвращена возможность отправлять команды мышью.
Все строковые значения вынесены в константы.
Добавлено закрытие дескриптора мьютекса после его освобождения.
Папка программы снова определяется через Application.ExeName.
Удалён ресурс WindowsXP.res.
Созданы подпапки \bin для скомпилированных модулей и \src для исходников.

20141028 Версия 3.1.3.40
Убран обработчик нажатия мыши со списка команд.
Теперь индекс команды обнуляется в конце процедуры SendCommand.
Оптимизация переключения раскладки клавиатуры.

20141013 Версия 3.1.2.39
Мелкие оптимизации.

20141007 Версия 3.1.1.38
Произведен откат класса TCommandList до наследника класса TObject.
Теперь область перемещения окна везде ограничена рабочей областью экрана.
Мелкие оптимизации кода главного окна.

20141003 Версия 3.1.0.37
После обновления игры 285 стало невозможно программно определить активный чат – командный или общий. Из-за этого теперь каждая команда имеет только одну комбинацию клавиш.
В связи с этим из программы были удалены все участки кода, разделяющиеся на командный и общий чаты.
Теперь комбинация клавиш отображается в верхнем правом углу строки.
Также TCommandList был преобразован в наследника TObjectList, для чего TCommand был преобразован в класс.
Дескриптор окна-владельца был вынесен на наивысший уровень модуля.
Теперь поиск последнего активного окна происходит ежесекундно в течение всей работы программы.
Из эмуляторов клавиатуры убраны скан-коды.
Упрощён обработчик WM_HOTKEY.

20140923 Версия 3.0.0.36
Произведено слияние всех трёх программ в одну. Это позволило уменьшить размер дистрибутива в два раза.
Добавлены параметры запуска из командной строки:
— /settings – изменить настройки запуска;
— /commands – изменить список команд.
Ускорено заполнение TListBox методом BeginUpdate..EndUpdate.
Мелкие оптимизации в публичных процедурах главного окна.

20140829 Версия 2.2.0.35
Баг версии 2.0.4.31 наконец-то исправлен путем жёсткого ограничения минимальной ширины окна 132px.
Все обработчики событий Windows вынесены в перекрытый WndProc.
Прекращена поддержка Windows XP.

20140817 Версия 2.1.1.34
Фикс: Теперь горячие клавиши не работают при свернутом приложении.
Оптимизирован таймер поиска целевого окна.
Обработчики WM_HOTKEY и WM_MOVING вынесены в событие Application.OnMessage.
Убран лишний параметр подпрограммы Restore.

20140815 Версия 2.1.0.33
Произведены мелкие оптимизации класса списка команд:
— удалена лишняя инициализация динамического массива в конструкторе;
— счетчик в деструкторе уменьшен до 1 байта;
— добавлена отдельная подпрограмма заполнения структуры горячих клавиш;
— поле THotKey.Shortcut стало локальной переменной созданной подпрограммы;
— добавлено явное обнуление AsString, если в нём не распознана комбинация клавиш;
— в подпрограммах RegHK и UnregHK минимизировано обращение к командам через поле FList.
Удалена строка меню, её пункты вызываются горячими клавишами:
— Ctrl+Q – выход;
— Shift+Ctrl+Alt+Space – окно «О программе».
Событие TListBox.OnExit удалено за ненадобностью.
Добавлена возможность свернуть программу, однако вернулся баг версии 2.0.4.31.
Оптимизирована проверка второго экземпляра приложения в главном коде.

20140811 Версия 2.0.5.32
Убраны лишние установки флагов Resize и CanClose в событиях OnCanResize и OnCanClose.
Вместо обычной строки меню добавлена ActionMainMenuBar.
Исправлен баг со скрытием формы за пределами экрана путем возврата ей меньшей строки заголовка.

20140805 Версия 2.0.4.31
Убрано мерцание при перемещении формы за пределы экрана методом обработки события WM_MOVING.
Оптимизировано определение курсора мыши над окном.

20140804 Версия 2.0.3.30
Произведены мелкие оптимизации, среди которых:
— для количества команд теперь везде выделен 1 байт;
— из деструктора списка команд убран вызов inherited;
— переменная позиции табуляции ограничена 1 байтом;
— удален за ненадобностью модуль ImgList, остававшийся после удаления иконки для трея;
— оптимизирован способ определения существования горячих клавиш для команды;
— убраны вызовы inherited в обработчиках событий Windows;
— модули IniFiles и Clipbrd теперь подключены в секции реализации.
Также исправлена логика обработки нажатий ЛКМ и ПКМ на разделителе: теперь ни одна из них на сжимает окно.

20140612 Версия 2.0.2.29
Убрано свойство формы AppPath. Теперь GetCurrentDir вызывается напрямую.
Убраны проверки перед сохранением настроек.
Убрана рамка TListBox.
Изменено имя файла настроек на Multiclip.ini.
Исправлен баг с невыделением высоты под горячие клавиши, если они располагаются внизу.
Известные баги: окно программы прячется за правый край экрана при скрытии, если пристыковано к нему.

20140609 Версия 2.0.0.28
Убрана иконка в трее, пункты её контекстного меню перенесены на строку меню главного окна.
Свойство List списка команд теперь по умолчанию, что сделало возможным заменить List на Self.
Сжаты типы данных Atom: Integer и Shortcut: Cardinal до слова.
Исправлена критическая ошибка с наложением общих и командных горячих клавиш.
В класс списка команд добавлен дескриптор окна-владельца.
Восстановлена стандартная высота строки заголовка главного окна программы.
Из-за удаления иконки в трее убрана возможность выключить приложение, после чего за ненадобностью удален флаг IsAppWork.

20140501 Версия 1.14.0.27
Элементы реализации списка команд, включая лексический анализатор, вынесены в модуль uCommandList.
Теперь используется упрощенный метод получения пути к программе – GetCurrentDir.
Теперь клик по именам авторов позволяет отправить им письмо с замечаниями и/или предложениями.
Добавлены проверки изменения настроек при их сохранении в ini-файл.
Во все вызовы keybd_event к виртуальным кодам клавиш добавлены их скан-коды.
Процедура ClickKey перемещена внутрь процедуры SendCommand, а последняя – в секцию public главного окна.
Вместо стандартных процедур Show и Hide теперь используются их более качественные аналоги из TCoolTrayIcon.

20140318 Версия 1.13.3.26
Фикс: Исправлена ошибка, вследствие которой на некоторых компьютерах искажались кириллические символы после буфера обмена.

20130825 Версия 1.13.2.25
Вместо переменной CommandIndexToSend используется тэг формы.
Фикс: Исправлен глюк с перемещением свернутой формы.

20130817 Версия 1.13.1.24
Произведены мелкие оптимизации, среди которых:
— добавлено удаление мьютекса контроля копий;
— теперь флаг командного чата процедуры SendCommand объявлен константным;
— убраны лишние включения/отключения таймера OnMouseLeave;
— убран inherited обработчика сообщения WM_MOVE.

20130801 Версия 1.13.1.23
Добавлен запрет запуска второй копии программы методом мьютекса.

20130717 Версия 1.13.0.22
Создана структура, содержащая список команд и её атрибутов.
Вместо переменной OldSelectItem используется TListBox.Tag.
Процедуры модуля перенесены в класс формы.
Убран пункт настроек из контекстного меню трея.

20130427 Версия 1.12.1.21
Добавлено условие, облегчающее обработчик формы OnMouseMove. Также из этого обработчика убраны лишние условия.
Также в обработчик WM_HOTKEY добавлен вызов inherited, благодаря которому окно обрабатывает стандартные горячие клавиши ОС Windows.

20130219 Версия 1.12.0.20
OpenDialog убран по причине увеличения времени загрузки приложения за счёт ожидания действий пользователя. Теперь файл списка команд предусматривается один – command.lst.

20130210 Версия 1.11.2.19
Добавлено окно «О программе».
Пунктом по умолчанию всплывающего меню трея назначено «Вкл./Выкл.». Также на него перенесен обработчик клика с трея.
Фикс: Окно теперь не сжимается, если оно не пристыковано к краю экрана.

20130120 Версия 1.11.1.18
Добавлен пункт настроек в контекстное меню трея.
Убрана первичная инициализация переменных, которые читаются из файла настроек.
Сгруппированы переменные в разделе их объявления.

20130113 Версия 1.11.0.17
Создано контекстное меню для иконки в трее, а также XPManifest.

20130108 Версия 1.10.3.16
Фикс: Исправлена ошибка, из-за которой не обрабатывались горячие клавиши.

20121216 Версия 1.10.2.15
Теперь таймер OnMouseLeave включается только один раз – при выходе из режима перемещения или изменения ширины окна.
Убрано по ненадобности создание cfg-файла при условии его отсутствия. Также убраны переменные для cfg-файла.
Добавлено свойство окна AppPath (полный путь к программе) вместо одноимённых локальных переменных.

20120927 Версия 1.10.1.14
Фикс: Программа закрывается автоматически, если не выбран файл списка команд.

20120907 Версия 1.10.0.13
Добавлен OpenDialog, благодаря которому теперь можно хранить несколько списков команд в различных lst-файлах.
Параметр Height удалён за ненадобностью.
Фикс: Для подсчёта количества команд теперь используется свойство TListBox.Count вместо TListBox.Items.Count.

20120903 Версия 1.9.3.12
Убран параметр HeightMode. Высота окна теперь вычисляется автоматически в зависимости от количества команд.

20120902 Версия 1.9.2.11
Теперь окно корректно пристыковывается к краям экрана благодаря свойству окна ScreenSnap.
Двухитерационные циклы преобразованы в соответствующие последовательности.
Фикс: Убран некликабельный пробел между нижними границами окна и списка команд.
Фикс: Упрощено копирование в буфер обмена.

20120825 Версия 1.9.1.10
Фикс: Не загружались параметры программы из файла настроек.
Переименованы некоторые локальные переменные.

20120815 Версия 1.9.0.9
Проведен рефакторинг исходного кода в соответствии со стилем Чарльза Калверта.
Файлы теперь используют стандартные имена – command.lst и config.cfg.

20091108 Версия 1.8
Подгружаются параметры от предыдущих версий (если хотите подгрузить свои фразы или настройки из старой версии, просто удалите новый файл перед запуском).
Настраиваемые цвета интерфейса.
Значок в трее для временного отключения программы.
Фикс: Копирование в буфер обмена переделано.

20091106 Версия 1.7
В список можно вставлять разделители – пустые строки.
Высота строк списка стала вариативна, зависит от наличия горячих клавиш.
Добавился параметр Height_mode – высота окна назначается (Manual) или определяется автоматически (Auto).
Добавился параметр Hotkey_pos – можно размещать горячие клавиши внизу (Down) или справа (Right) каждой строки.

20091106 Версия 1.6
Если фраза начинается с символа «%», то при вводе в чат она не будет отправлена и будет доступна для редактирования.
Фикс: Перепутаны горячие клавиши для командного и общего чата.

20091106 Версия 1.5
Теперь можно прилеплять окно к левому или правому краю экрана, а также перемещать.
Можно назначать горячие клавиши для добавления в командный и общий чат (командный – после первой табуляции, общий – после второй).
Мелкие фиксы – при перемещении и изменении размеров не происходит скрытия окна.

20091105 Версия 1.4
Добавлен параметр window_name. Если он указан – вставка осуществляется только в окно с этим именем, если оно активно.

20091105 Версия 1.3
Фикс: Горячие клавиши с функциональными клавишами поправлены – перед вставкой ожидается отпускание клавиш.

20091103 Версия 1.2
Добавлены горячие клавиши.
На каждую строчку в файле .lst можно дописывать после табуляции горячую клавишу (букву).
В окне списка показывается горячая клавиша. Если она не задана или не удалось распознать – не показывается. Если не удалось установить – красным цветом.
По горячей клавише вставка производится в командный чат.
Фикс: Левой кнопкой – в командный чат, правой – в общий чат.
Фикс: Минимальная ширина окна обнулена. На двухмониторных системах должно работать корректно.
Автоподбор высоты окна (Параметр Height больше не используется).
Недоделки: при вставке используется эмуляция клавиш, конфликтует с горячими клавишами, использующими функциональные клавиши Ctrl, Alt, Shift.
Идеи: Если кому-то покажется востребованным, можно сделать установки своих цветов.

20091028 Версия 1.1
При запуске маячит в правой части экрана.
Убрал иконку в трее как бесполезную.
Регулируется расстояние от края экрана (RX).
Левой кнопкой посылается сообщение в командный чат, правой – в общий чат.
Вставка строки сразу в окно танков.
Передача управления обратно в окно танков (!).